<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>09 - Image Classifier ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</title>
    <script src="https://unpkg.com/ml5@1/dist/ml5.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .upload-area { border: 3px dashed #ccc; border-radius: 15px; padding: 40px; margin: 20px 0; background: white; cursor: pointer; transition: all 0.3s; }
        .upload-area:hover { border-color: #667eea; background: #f8f9ff; }
        .upload-area.dragover { border-color: #667eea; background: #e8ebff; }
        #preview { max-width: 400px; max-height: 400px; border-radius: 10px; display: none; margin: 20px auto; }
        #results { background: white; padding: 20px; border-radius: 15px; margin-top: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .result-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; }
        .result-item:last-child { border-bottom: none; }
        .label { font-weight: bold; font-size: 18px; }
        .confidence-bar { width: 200px; height: 20px; background: #e0e0e0; border-radius: 10px; overflow: hidden; }
        .confidence-fill { height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.5s; }
        input[type="file"] { display: none; }
        h1 { color: #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç”»åƒåˆ†é¡ - è¤‡æ•°çµæœè¡¨ç¤º</h1>
        <p>ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</p>

        <div class="upload-area" id="uploadArea">
            <p>ğŸ“· ç”»åƒã‚’ã“ã“ã«ãƒ‰ãƒ­ãƒƒãƒ—<br>ã¾ãŸã¯<br>ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</p>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <img id="preview" crossorigin="anonymous">

        <div id="results" style="display: none;">
            <h3>åˆ†é¡çµæœï¼ˆä¸Šä½5ä»¶ï¼‰</h3>
            <div id="resultsList"></div>
        </div>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const preview = document.getElementById('preview');
        const results = document.getElementById('results');
        const resultsList = document.getElementById('resultsList');

        let classifier;

        // åˆ†é¡å™¨ã‚’åˆæœŸåŒ–
        async function initClassifier() {
            classifier = await ml5.imageClassifier('MobileNet');
        }
        initClassifier();

        // ã‚¯ãƒªãƒƒã‚¯ã§ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
        uploadArea.onclick = () => fileInput.click();

        // ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
        uploadArea.ondragover = (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        };

        uploadArea.ondragleave = () => {
            uploadArea.classList.remove('dragover');
        };

        uploadArea.ondrop = (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                processImage(file);
            }
        };

        // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                processImage(file);
            }
        };

        // ç”»åƒã‚’å‡¦ç†
        function processImage(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                preview.src = e.target.result;
                preview.style.display = 'block';
                preview.onload = classifyImage;
            };
            reader.readAsDataURL(file);
        }

        // ç”»åƒã‚’åˆ†é¡
        async function classifyImage() {
            if (!classifier) {
                resultsList.innerHTML = '<p>åˆ†é¡å™¨ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>';
                results.style.display = 'block';
                return;
            }

            resultsList.innerHTML = '<p>åˆ†é¡ä¸­...</p>';
            results.style.display = 'block';

            const classifyResults = await classifier.classify(preview, 5);

            resultsList.innerHTML = '';
            for (let result of classifyResults) {
                const confidence = (result.confidence * 100).toFixed(1);
                const item = document.createElement('div');
                item.className = 'result-item';
                item.innerHTML = `
                    <span class="label">${result.label}</span>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${confidence}%"></div>
                        </div>
                        <span>${confidence}%</span>
                    </div>
                `;
                resultsList.appendChild(item);
            }
        }
    </script>
</body>
</html>
